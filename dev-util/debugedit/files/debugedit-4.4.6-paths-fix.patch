--- debugedit.c.orig	2008-01-12 21:54:20.000000000 -0500
+++ debugedit.c	2008-01-12 21:56:02.000000000 -0500
@@ -437,8 +437,15 @@
   int prefix_len;
   
   str_len = strlen (str);
+
+  if (str[str_len - 1] == '/')
+    str_len--;
+
   prefix_len = strlen (prefix);
 
+  if (prefix[prefix_len - 1] == '/')
+    prefix_len--;
+
   if (str_len < prefix_len)
     return 0;
   
@@ -732,7 +739,7 @@
 
 		  if (phase == 1 && dest_dir && has_prefix (ptr, base_dir))
 		    {
-		      base_len = strlen (base_dir);
+		      base_len = strlen (ptr);
 		      dest_len = strlen (dest_dir);
 
 		      memcpy (ptr, dest_dir, dest_len);
@@ -759,7 +766,7 @@
 
 	      if (phase == 1 && dest_dir && has_prefix (dir, base_dir))
 		{
-		  base_len = strlen (base_dir);
+		  base_len = strlen (dir);
 		  dest_len = strlen (dest_dir);
 		  
 		  memcpy (dir, dest_dir, dest_len);
