From 48f8c9f2cec4a652cb095b9f9a0f34f77f026249 Mon Sep 17 00:00:00 2001
From: Elvis Pranskevichus <elprans@gmail.com>
Date: Sat, 16 Jan 2010 22:45:58 -0500
Subject: [PATCH] Add support for UUID typio

---
 postgresql/protocol/typio.py   |   10 ++++++++++
 postgresql/test/test_driver.py |    5 +++++
 2 files changed, 15 insertions(+), 0 deletions(-)

diff --git a/postgresql/protocol/typio.py b/postgresql/protocol/typio.py
index a53c253..0dc0f78 100644
--- a/postgresql/protocol/typio.py
+++ b/postgresql/protocol/typio.py
@@ -36,6 +36,7 @@ Map PostgreSQL type Oids to routines that pack and unpack raw data.
  time64_noday_io
   long-long based time I/O with noday-intervals.
 """
+import uuid
 import warnings
 import codecs
 from ..encodings import aliases as pg_enc_aliases
@@ -266,6 +267,13 @@ def circle_unpack(x):
 	x = ts.circle_unpack(x)
 	return pg_types.circle(((x[0], x[1]), x[2]))
 
+def uuid_pack(x):
+	if isinstance(x, uuid.UUID):
+		return bytes(x.bytes)
+	return bytes(uuid.UUID(x).bytes)
+def uuid_unpack(x):
+	return uuid.UUID(bytes=x)
+
 ##
 # numeric is represented using:
 #  ndigits, the number of *numeric* digits.
@@ -419,6 +427,8 @@ oid_to_io = {
 	pg_types.BOXOID : (box_pack, box_unpack),
 	pg_types.LSEGOID : (lseg_pack, lseg_unpack),
 	pg_types.CIRCLEOID : (circle_pack, circle_unpack),
+
+	pg_types.UUIDOID : (uuid_pack, uuid_unpack),
 }
 
 oid_to_io[pg_types.CIDROID] = (None, None)
diff --git a/postgresql/test/test_driver.py b/postgresql/test/test_driver.py
index 6594ff7..7ce8eb4 100644
--- a/postgresql/test/test_driver.py
+++ b/postgresql/test/test_driver.py
@@ -10,6 +10,7 @@ import threading
 import time
 import datetime
 import decimal
+import uuid
 from itertools import chain, islice
 from operator import itemgetter
 
@@ -268,6 +269,10 @@ type_samples = [
 			pg_types.varbit('010111101111'),
 		],
 	),
+	('uuid', [
+			uuid.uuid1(),
+		],
+	),
 ]
 
 if False:
-- 
1.6.5.8

