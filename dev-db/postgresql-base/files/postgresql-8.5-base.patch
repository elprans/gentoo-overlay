From 5f21f0d0a3f4d9b0d9f625253e60e5f917290303 Mon Sep 17 00:00:00 2001
From: Elvis Pranskevichus <elvis@alfheim.prans.org>
Date: Tue, 6 Jan 2009 14:33:27 -0500
Subject: [PATCH] [gentoo] Base patch

---
 contrib/Makefile               |   38 --------------------------------------
 src/Makefile                   |    5 -----
 src/backend/Makefile           |   23 +++--------------------
 src/bin/Makefile               |    4 ++--
 src/include/pg_config_manual.h |    2 +-
 5 files changed, 6 insertions(+), 66 deletions(-)

diff --git a/contrib/Makefile b/contrib/Makefile
index 19d5c1b..c95b68f 100644
--- a/contrib/Makefile
+++ b/contrib/Makefile
@@ -5,48 +5,10 @@ top_builddir = ..
 include $(top_builddir)/src/Makefile.global
 
 SUBDIRS = \
-		adminpack	\
-		auto_explain	\
-		btree_gin	\
-		btree_gist	\
-		chkpass		\
-		citext		\
-		cube		\
-		dblink		\
-		dict_int	\
-		dict_xsyn	\
-		earthdistance	\
-		fuzzystrmatch	\
-		hstore		\
-		intagg		\
-		intarray	\
-		isn		\
-		lo		\
-		ltree		\
 		oid2name	\
-		pageinspect	\
-		passwordcheck	\
-		pg_buffercache	\
-		pg_freespacemap \
-		pg_standby	\
-		pg_stat_statements \
-		pg_trgm		\
 		pgbench		\
-		pgcrypto	\
-		pgrowlocks	\
-		pgstattuple	\
-		seg		\
-		spi		\
-		tablefunc	\
-		test_parser	\
-		tsearch2	\
-		unaccent	\
 		vacuumlo
 
-ifeq ($(with_openssl),yes)
-SUBDIRS += sslinfo
-endif
-
 ifeq ($(with_ossp_uuid),yes)
 SUBDIRS += uuid-ossp
 endif
diff --git a/src/Makefile b/src/Makefile
index 7aedee2..ebce372 100644
--- a/src/Makefile
+++ b/src/Makefile
@@ -15,16 +15,11 @@ include Makefile.global
 
 all install installdirs uninstall distprep:
 	$(MAKE) -C port $@
-	$(MAKE) -C timezone $@
 	$(MAKE) -C backend $@
-	$(MAKE) -C backend/utils/mb/conversion_procs $@
-	$(MAKE) -C backend/snowball $@
 	$(MAKE) -C include $@
 	$(MAKE) -C interfaces $@
 	$(MAKE) -C bin $@
-	$(MAKE) -C pl $@
 	$(MAKE) -C makefiles $@
-	$(MAKE) -C test/regress $@
 
 install: install-local
 
diff --git a/src/backend/Makefile b/src/backend/Makefile
index 34b4a8b..242b3f1 100644
--- a/src/backend/Makefile
+++ b/src/backend/Makefile
@@ -42,7 +42,7 @@ LIBS := $(filter-out -lz -lreadline -ledit -ltermcap -lncurses -lcurses, $(LIBS)
 
 ##########################################################################
 
-all: submake-libpgport postgres $(POSTGRES_IMP)
+all: someheaders
 
 ifneq ($(PORTNAME), cygwin)
 ifneq ($(PORTNAME), win32)
@@ -111,8 +111,7 @@ endif
 endif # aix
 
 # Update the commonly used headers before building the subdirectories
-$(SUBDIRS:%=%-recursive): $(top_builddir)/src/include/parser/gram.h $(top_builddir)/src/include/utils/fmgroids.h $(top_builddir)/src/include/utils/probes.h
-
+someheaders $(DIRS:%=%-recursive): $(top_builddir)/src/include/parser/gram.h $(top_builddir)/src/include/utils/fmgroids.h $(top_builddir)/src/include/utils/probes.h
 
 # The postgres.o target is needed by the rule in Makefile.global that
 # creates the exports file when MAKE_EXPORTS = true.
@@ -165,23 +164,7 @@ distprep:
 
 ##########################################################################
 
-install: all installdirs install-bin
-ifeq ($(PORTNAME), cygwin)
-ifeq ($(MAKE_DLL), true)
-	$(INSTALL_DATA) libpostgres.a '$(DESTDIR)$(libdir)/libpostgres.a'
-endif
-endif
-ifeq ($(PORTNAME), win32)
-ifeq ($(MAKE_DLL), true)
-	$(INSTALL_DATA) libpostgres.a '$(DESTDIR)$(libdir)/libpostgres.a'
-endif
-endif
-	$(MAKE) -C catalog install-data
-	$(MAKE) -C tsearch install-data
-	$(INSTALL_DATA) $(srcdir)/libpq/pg_hba.conf.sample '$(DESTDIR)$(datadir)/pg_hba.conf.sample'
-	$(INSTALL_DATA) $(srcdir)/libpq/pg_ident.conf.sample '$(DESTDIR)$(datadir)/pg_ident.conf.sample'
-	$(INSTALL_DATA) $(srcdir)/utils/misc/postgresql.conf.sample '$(DESTDIR)$(datadir)/postgresql.conf.sample'
-	$(INSTALL_DATA) $(srcdir)/access/transam/recovery.conf.sample '$(DESTDIR)$(datadir)/recovery.conf.sample'
+install:
 
 install-bin: postgres $(POSTGRES_IMP) installdirs
 	$(INSTALL_PROGRAM) postgres$(X) '$(DESTDIR)$(bindir)/postgres$(X)'
diff --git a/src/bin/Makefile b/src/bin/Makefile
index a01d1f9..3ad244d 100644
--- a/src/bin/Makefile
+++ b/src/bin/Makefile
@@ -13,8 +13,8 @@ subdir = src/bin
 top_builddir = ../..
 include $(top_builddir)/src/Makefile.global
 
-SUBDIRS = initdb pg_ctl pg_dump \
-	psql scripts pg_config pg_controldata pg_resetxlog
+SUBDIRS = pg_dump psql scripts pg_config
+
 ifeq ($(PORTNAME), win32)
 SUBDIRS+=pgevent
 endif
diff --git a/src/include/pg_config_manual.h b/src/include/pg_config_manual.h
index f034be9..c342204 100644
--- a/src/include/pg_config_manual.h
+++ b/src/include/pg_config_manual.h
@@ -146,7 +146,7 @@
  * here's where to twiddle it.  You can also override this at runtime
  * with the postmaster's -k switch.
  */
-#define DEFAULT_PGSOCKET_DIR  "/tmp"
+#define DEFAULT_PGSOCKET_DIR  "/var/run/postgresql"
 
 /*
  * The random() function is expected to yield values between 0 and
-- 
1.6.5.3

